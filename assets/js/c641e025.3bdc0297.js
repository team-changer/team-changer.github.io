"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8457],{3905:(t,n,e)=>{e.d(n,{Zo:()=>u,kt:()=>g});var a=e(67294);function r(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function l(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,a)}return e}function i(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?l(Object(e),!0).forEach((function(n){r(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):l(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function p(t,n){if(null==t)return{};var e,a,r=function(t,n){if(null==t)return{};var e,a,r={},l=Object.keys(t);for(a=0;a<l.length;a++)e=l[a],n.indexOf(e)>=0||(r[e]=t[e]);return r}(t,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)e=l[a],n.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(r[e]=t[e])}return r}var d=a.createContext({}),o=function(t){var n=a.useContext(d),e=n;return t&&(e="function"==typeof t?t(n):i(i({},n),t)),e},u=function(t){var n=o(t.components);return a.createElement(d.Provider,{value:n},t.children)},s="mdxType",m={inlineCode:"code",wrapper:function(t){var n=t.children;return a.createElement(a.Fragment,{},n)}},k=a.forwardRef((function(t,n){var e=t.components,r=t.mdxType,l=t.originalType,d=t.parentName,u=p(t,["components","mdxType","originalType","parentName"]),s=o(e),k=r,g=s["".concat(d,".").concat(k)]||s[k]||m[k]||l;return e?a.createElement(g,i(i({ref:n},u),{},{components:e})):a.createElement(g,i({ref:n},u))}));function g(t,n){var e=arguments,r=n&&n.mdxType;if("string"==typeof t||r){var l=e.length,i=new Array(l);i[0]=k;var p={};for(var d in n)hasOwnProperty.call(n,d)&&(p[d]=n[d]);p.originalType=t,p[s]="string"==typeof t?t:r,i[1]=p;for(var o=2;o<l;o++)i[o]=e[o];return a.createElement.apply(null,i)}return a.createElement.apply(null,e)}k.displayName="MDXCreateElement"},46205:(t,n,e)=>{e.r(n),e.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>p,toc:()=>o});var a=e(87462),r=(e(67294),e(3905));const l={title:"\uc870\ud68c \ucffc\ub9ac \uc131\ub2a5 \uac1c\uc120\ud558\uae30",slug:"Query performance tuning",authors:["huchu"],tags:["MySql","Query Tuning","JPA","QueryDsl"]},i=void 0,p={permalink:"/Query performance tuning",editUrl:"https://github.com/trip-draw/trip-draw.github.io/tree/main/blog/2023-11-09-\uc870\ud68c \ucffc\ub9ac \uc131\ub2a5 \uac1c\uc120\ud558\uae30.mdx",source:"@site/blog/2023-11-09-\uc870\ud68c \ucffc\ub9ac \uc131\ub2a5 \uac1c\uc120\ud558\uae30.mdx",title:"\uc870\ud68c \ucffc\ub9ac \uc131\ub2a5 \uac1c\uc120\ud558\uae30",description:"\ub4e4\uc5b4\uac00\uae30",date:"2023-11-09T00:00:00.000Z",formattedDate:"2023\ub144 11\uc6d4 9\uc77c",tags:[{label:"MySql",permalink:"/tags/my-sql"},{label:"Query Tuning",permalink:"/tags/query-tuning"},{label:"JPA",permalink:"/tags/jpa"},{label:"QueryDsl",permalink:"/tags/query-dsl"}],readingTime:16.97,hasTruncateMarker:!1,authors:[{name:"\ud6c4\ucd94",title:"Backend",url:"https://github.com/Combi153",imageURL:"https://github.com/Combi153.png",key:"huchu"}],frontMatter:{title:"\uc870\ud68c \ucffc\ub9ac \uc131\ub2a5 \uac1c\uc120\ud558\uae30",slug:"Query performance tuning",authors:["huchu"],tags:["MySql","Query Tuning","JPA","QueryDsl"]},prevItem:{title:"Local Caching \uc801\uc6a9\ud558\uae30",permalink:"/Local Caching"},nextItem:{title:"\ud68c\uc6d0 \uc0ad\uc81c N+1 \ubb38\uc81c @Query\ub85c \ud574\uacb0\ud558\uae30 (feat. \ucee4\ubc84\ub9c1 \uc778\ub371\uc2a4)",permalink:"/JPA N + 1 Problem"}},d={authorsImageUrls:[void 0]},o=[{value:"\ub4e4\uc5b4\uac00\uae30",id:"\ub4e4\uc5b4\uac00\uae30",level:2},{value:"\uae30\uc874 \ucffc\ub9ac",id:"\uae30\uc874-\ucffc\ub9ac",level:2},{value:"DB Schema",id:"db-schema",level:3},{value:"\uac80\uc0c9 \uc870\uac74\uc774 \uc5c6\ub294 \uacbd\uc6b0",id:"\uac80\uc0c9-\uc870\uac74\uc774-\uc5c6\ub294-\uacbd\uc6b0",level:3},{value:"\uac80\uc0c9 \uc870\uac74\uc774 \uc788\ub294 \uacbd\uc6b0",id:"\uac80\uc0c9-\uc870\uac74\uc774-\uc788\ub294-\uacbd\uc6b0",level:3},{value:"\ubb38\uc81c \uc778\uc2dd",id:"\ubb38\uc81c-\uc778\uc2dd",level:2},{value:"1. \ubd88\ud544\uc694\ud55c Join",id:"1-\ubd88\ud544\uc694\ud55c-join",level:3},{value:"2. \ubd88\ud544\uc694\ud55c \uc911\ubcf5 \ub370\uc774\ud130 \uc0dd\uc131",id:"2-\ubd88\ud544\uc694\ud55c-\uc911\ubcf5-\ub370\uc774\ud130-\uc0dd\uc131",level:3},{value:"\ucffc\ub9ac \ubcc0\uacbd",id:"\ucffc\ub9ac-\ubcc0\uacbd",level:2},{value:"Subquery",id:"subquery",level:3},{value:"\ucffc\ub9ac \ub098\ub204\uae30",id:"\ucffc\ub9ac-\ub098\ub204\uae30",level:3},{value:"\uc870\uac74\uc5d0 \ub530\ub77c Query \ub098\ub204\uae30",id:"\uc870\uac74\uc5d0-\ub530\ub77c-query-\ub098\ub204\uae30",level:3},{value:"\uac80\uc0c9 \uc870\uac74\uc774 \uc5c6\ub294 \uacbd\uc6b0",id:"\uac80\uc0c9-\uc870\uac74\uc774-\uc5c6\ub294-\uacbd\uc6b0-1",level:4},{value:"\uc2dc\uac04 \uc870\uac74\ub9cc \uc788\ub294 \uacbd\uc6b0",id:"\uc2dc\uac04-\uc870\uac74\ub9cc-\uc788\ub294-\uacbd\uc6b0",level:4},{value:"\uc8fc\uc18c \uc870\uac74\ub9cc \uc788\ub294 \uacbd\uc6b0",id:"\uc8fc\uc18c-\uc870\uac74\ub9cc-\uc788\ub294-\uacbd\uc6b0",level:4},{value:"\uc2dc\uac04 \uc870\uac74, \uc8fc\uc18c \uc870\uac74\uc774 \ubaa8\ub450 \uc788\ub294 \uacbd\uc6b0",id:"\uc2dc\uac04-\uc870\uac74-\uc8fc\uc18c-\uc870\uac74\uc774-\ubaa8\ub450-\uc788\ub294-\uacbd\uc6b0",level:4},{value:"QueryDsl \ucf54\ub4dc",id:"querydsl-\ucf54\ub4dc",level:2},{value:"\uacb0\uacfc",id:"\uacb0\uacfc",level:2}],u={toc:o},s="wrapper";function m(t){let{components:n,...e}=t;return(0,r.kt)(s,(0,a.Z)({},u,e,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"\ub4e4\uc5b4\uac00\uae30"},"\ub4e4\uc5b4\uac00\uae30"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://play.google.com/store/apps/details?id=com.teamtripdraw.android"},"\ud2b8\ub9bd\ub4dc\ub85c\uc6b0")," \ud300 \ud504\ub85c\uc81d\ud2b8\ub97c \uc9c4\ud589\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://velog.velcdn.com/images/153plane/post/7488a446-2546-4f5e-9f41-1862fad5655e/image.png",alt:null})),(0,r.kt)("p",null,"\ud2b8\ub9bd\ub4dc\ub85c\uc6b0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\ub294 \ub2e4\ub978 \uc0ac\uc6a9\uc790\ub4e4\uc758 \uc5ec\ud589\uc744 \ubcfc \uc218 \uc788\ub294 ",(0,r.kt)("inlineCode",{parentName:"p"},"\ubaa8\ub450\uc758 \uc5ec\ud589")," \ud0ed\uc774 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\ubaa8\ub450\uc758 \uc5ec\ud589")," \ud0ed\uc5d0\uc11c \uc2a4\ud06c\ub864\uc744 \ub0b4\ub9ac\uba70 \ub2e4\ub978 \uc0ac\ub78c\uc774 \uc5b4\ub5a4 \uacbd\ub85c\ub85c \uc5ec\ud589\uc744 \ub2e4\ub154\ub294\uc9c0, \uc5b4\ub5a4 \uac10\uc0c1\uc744 \ub0a8\uacbc\ub294\uc9c0 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc8fc\uc18c(\uc9c0\uc5ed), \uc2dc\uac04(\ub0a0\uc9dc) \ub4f1\uc5d0 \ub530\ub77c \uc870\uac74\uc744 \uac78\uc5b4 ",(0,r.kt)("inlineCode",{parentName:"p"},"\uac80\uc0c9"),"\uc744 \ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc774 \uae30\ub2a5\uc744 \ud1b5\ud574 \uc0ac\uc6a9\uc790\uac00 \uc5ec\ud589 \uacbd\ub85c, \uc74c\uc2dd \ub9db\uc9d1, \ud48d\uacbd\uc774 \uc608\uc05c \uc7a5\uc18c \ub4f1\uc758 \uc5ec\ud589 \uc815\ubcf4\ub97c \uc5bb\uc5b4\uac00\uae30\ub97c \uae30\ub300\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://velog.velcdn.com/images/153plane/post/a9374d3e-1aa3-4332-9834-581b23e32918/image.png",alt:null})),(0,r.kt)("p",null,"\ud558\uc9c0\ub9cc ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"\ubaa8\ub4e0 \uc5ec\ud589 \uc870\ud68c API"),"\uc758 \uc694\uccad \ucc98\ub9ac \uc2dc\uac04\uc774 \uc608\uc0c1\ubcf4\ub2e4 \ub9e4\uc6b0 \ub290\ub838\uc2b5\ub2c8\ub2e4.")),(0,r.kt)("p",null,"DB\uc5d0\ub294 \uc5ec\ud589, \uc704\uce58\uc815\ubcf4, \uac10\uc0c1 \ub4f1\uc758 \ub370\uc774\ud130\ub97c \ud569\ud574 \uc57d 200,000\uac1c\uc758 \ub370\uc774\ud130\uac00 \uc874\uc7ac\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc544\ubb34\ub7f0 \uac80\uc0c9 \uc870\uac74 \uc5c6\uc774 \uc870\ud68c\ud560 \uacbd\uc6b0 \ud3c9\uade0\uc801\uc73c\ub85c ",(0,r.kt)("strong",{parentName:"p"},"\uc57d 600ms \ub97c \uae30\ub85d"),"\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uac80\uc0c9 \uc870\uac74\uc774 \uc788\uc744 \ub54c\ub294 \uc2dc\uac04\uc774 \ub35c \uac78\ub838\uc2b5\ub2c8\ub2e4\ub9cc \ub9cc\uc871\uc2a4\ub7ec\uc6b4 \uc218\uc900\uc774 \uc544\ub2c8\uc5c8\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\ubaa8\ub4e0 \uc5ec\ud589 \uc870\ud68c API")," \ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c \uc0ac\uc6a9\uc790\uac00 \uac00\uc7a5 \uc790\uc8fc \uc694\uccad\ud560 API\uc600\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ub530\ub77c\uc11c \uc694\uccad \ucc98\ub9ac \uc2dc\uac04\uc744 \ub2e8\ucd95\uc2dc\ud0a4\uae30 \uc704\ud574 \uc870\ud68c \ucffc\ub9ac\ub97c \uc0b4\ud3b4\ubcf4\uace0 \uc218\uc815\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc218\uc815 \uacb0\uacfc 600ms \uc758 \uc694\uccad \uc2dc\uac04\uc740 13ms \uae4c\uc9c0 \ub2e8\ucd95 \ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uadf8 \uacfc\uc815\uc744 \uacf5\uc720\ud569\ub2c8\ub2e4."),(0,r.kt)("h1",{id:"\uc870\ud68c-\ucffc\ub9ac-\uac1c\uc120\ud558\uae30"},"\uc870\ud68c \ucffc\ub9ac \uac1c\uc120\ud558\uae30"),(0,r.kt)("h2",{id:"\uae30\uc874-\ucffc\ub9ac"},"\uae30\uc874 \ucffc\ub9ac"),(0,r.kt)("h3",{id:"db-schema"},"DB Schema"),(0,r.kt)("p",null,"DB Schema \ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4."),(0,r.kt)("img",{src:"https://velog.velcdn.com/images/153plane/post/2615a647-73ba-4a7f-925d-3e7915d1dcc4/image.png",width:"80%"}),(0,r.kt)("p",null,"Trip\uacfc Point\ub294 1:N \uad00\uacc4, Trip\uacfc Post\ub294 1:N \uad00\uacc4\uc785\ub2c8\ub2e4. Point\uc640 Post\ub294 1:1 \uad00\uacc4\uc785\ub2c8\ub2e4."),(0,r.kt)("p",null,"Point \ub294 trip_id\ub97c \uc678\ub798\ud0a4\ub85c \uac16\uc2b5\ub2c8\ub2e4. \ub610\ud55c Post \ub97c \uac16\ub294\uc9c0 \uc5ec\ubd80\ub97c has_post\ub85c \uac16\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"Post \ub294 trip_id, point_id \ub97c \uc678\ub798\ud0a4\ub85c \uac16\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc774\uc81c \ucffc\ub9ac\ub97c \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"\uac80\uc0c9-\uc870\uac74\uc774-\uc5c6\ub294-\uacbd\uc6b0"},"\uac80\uc0c9 \uc870\uac74\uc774 \uc5c6\ub294 \uacbd\uc6b0"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\ubaa8\ub4e0 \uc5ec\ud589 \uc870\ud68c API")," \ub97c \uc694\uccad\ud558\uba74 DB\uc5d0 \uc2e4\ud589\ub418\ub294 \ucffc\ub9ac\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT DISTINCT t.trip_id,\n                t.created_at,\n                t.image_url,\n                t.member_id,\n                t.name,\n                t.route_image_url,\n                t.status,\n                t.updated_at\nFROM trip t\n         JOIN post ps ON t.trip_id = ps.trip_id\n         JOIN point poi ON ps.point_id = poi.point_id\nORDER BY t.trip_id DESC\nLIMIT 20;\n")),(0,r.kt)("p",null,"trip_id\ub97c \ub0b4\ub9bc\ucc28\uc21c\uc73c\ub85c \uc815\ub82c\ud574\uc11c 20\uac1c\uc758 Trip \ub370\uc774\ud130\ub97c \uc870\ud68c\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"Trip, Post, Point \uc138 \uac1c\uc758 \ud14c\uc774\ube14\uc744 JOIN \ud588\uace0, \uc911\ubcf5\uc744 \uc81c\uac70\ud558\uae30 \uc704\ud574 DISTINCT \ud0a4\uc6cc\ub4dc\ub97c \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"Pagination \uc744 \uc704\ud574 ORDER BY \uc640 LIMIT \uc744 \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"\uac80\uc0c9-\uc870\uac74\uc774-\uc788\ub294-\uacbd\uc6b0"},"\uac80\uc0c9 \uc870\uac74\uc774 \uc788\ub294 \uacbd\uc6b0"),(0,r.kt)("p",null,"\uac80\uc0c9 \uc870\uac74\uc774 \uc788\ub294 \uacbd\uc6b0\uc5d0\ub294 \ucffc\ub9ac\uac00 \ub2e4\ub985\ub2c8\ub2e4."),(0,r.kt)("p",null,'\uc8fc\uc18c \uc870\uac74\uc73c\ub85c "\uc11c\uc6b8\ud2b9\ubcc4\uc2dc", \uc2dc\uac04 \uc870\uac74\uc73c\ub85c "2023\ub144", "5\uc6d4"\uc744 \ud3ec\ud568\ud558\ub294 \ubaa8\ub4e0 \uc5ec\ud589\uc744 \uc870\ud68c\ud558\uba74 DB\uc5d0 \uc2e4\ud589\ub418\ub294 \ucffc\ub9ac\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT DISTINCT t.trip_id,\n                t.created_at,\n                t.image_url,\n                t.member_id,\n                t.name,\n                t.route_image_url,\n                t.status,\n                t.updated_at\nFROM trip t\n         JOIN post ps ON t.trip_id = ps.trip_id\n         JOIN point poi ON ps.point_id = poi.point_id\nWHERE\n    YEAR (poi.recorded_at) = 2023 AND\n    MONTH (poi.recorded_at) = 5 AND\n    ps.address LIKE '\uc11c\uc6b8\ud2b9\ubcc4\uc2dc%' ESCAPE '!'\nORDER BY t.trip_id DESC\nLIMIT 10;\n")),(0,r.kt)("p",null,"WHERE \uc808\uc5d0\uc11c Point \uc758 recorded_at \uc774 \uc2dc\uac04 \uc870\uac74\uc5d0 \ub9de\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ub610\ud55c WHERE \uc808\uc5d0\uc11c LIKE \ud0a4\uc6cc\ub4dc\ub97c \ud65c\uc6a9\ud574 \uc8fc\uc18c \uc870\uac74\uc5d0 \ub9de\ub294 \ub370\uc774\ud130\ub97c \uc870\ud68c\ud569\ub2c8\ub2e4."),(0,r.kt)("h2",{id:"\ubb38\uc81c-\uc778\uc2dd"},"\ubb38\uc81c \uc778\uc2dd"),(0,r.kt)("p",null,"DB Schema \ub97c \uae30\ubc18\uc73c\ub85c \ucffc\ub9ac\ub97c \uc5ec\ub7ec\ubaa8\ub85c \ubc14\uafd4\ubcf4\uba74\uc11c \ubb38\uc81c\uc810\uc744 \uc778\uc2dd\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ud06c\uac8c \ub450 \uac00\uc9c0 \ubb38\uc81c\uac00 \uc788\uc5c8\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"1-\ubd88\ud544\uc694\ud55c-join"},"1. \ubd88\ud544\uc694\ud55c Join"),(0,r.kt)("p",null,"\uccab \ubc88\uc9f8\ub85c \ubd88\ud544\uc694\ud55c \ud14c\uc774\ube14 Join \uc744 \ubc1c\uacac\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uac80\uc0c9 \uc870\uac74\uc774 \uc5c6\ub294 \uacbd\uc6b0\uc5d0 \ubaa8\ub4e0 \uc5ec\ud589 \uc870\ud68c \ucffc\ub9ac\ub294 \uc544\ub798\uc640 \uac19\uc558\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT DISTINCT t.trip_id,\n                t.created_at,\n                t.image_url,\n                t.member_id,\n                t.name,\n                t.route_image_url,\n                t.status,\n                t.updated_at\nFROM trip t\n         JOIN post ps ON t.trip_id = ps.trip_id\n         JOIN point poi ON ps.point_id = poi.point_id\nORDER BY t.trip_id DESC\nLIMIT 20;\n")),(0,r.kt)("p",null,"\uac80\uc0c9 \uc870\uac74\uc774 \uc788\ub294 \uacbd\uc6b0\uc5d0\ub294 Point\uc758 recorded_at \ud639\uc740 Post\uc758 address \uceec\ub7fc\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \ub530\ub77c\uc11c Post, Point \ud14c\uc774\ube14\uc744 Join \ud558\ub294 \uac83\uc774 \uc801\uc808\ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ud558\uc9c0\ub9cc \uac80\uc0c9 \uc870\uac74\uc774 \uc5c6\ub294 \uacbd\uc6b0\uc5d0\ub294 \uc774\ub7ec\ud55c \ub370\uc774\ud130\uac00 \ud544\uc694\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ub3d9\uc77c\ud55c Trip \ub370\uc774\ud130\ub97c \ubc18\ud658\ud558\uba74\uc11c \ubd88\ud544\uc694\ud55c Join\uc744 \uc5c6\uc564\ub2e4\uba74 \ucffc\ub9ac\ub97c \ub2e4\uc74c\uacfc \uac19\uc774 \ubcc0\uacbd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT DISTINCT t.trip_id,\n                t.created_at,\n                t.image_url,\n                t.member_id,\n                t.name,\n                t.route_image_url,\n                t.status,\n                t.updated_at\nFROM trip t\n         JOIN point poi ON t.trip_id = poi.trip_id\nWHERE poi.has_post = TRUE\nORDER BY t.trip_id DESC LIMIT 20;\n")),(0,r.kt)("p",null,"Trip\uc640 Point\ub9cc trip_id\ub97c \uae30\uc900\uc73c\ub85c Join \ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc774\ud6c4 WHERE \uc808\ub85c Post\uac00 \uc874\uc7ac\ud558\ub294 Trip \ub370\uc774\ud130\ub97c \uc870\ud68c\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ubc18\ud658 \ub370\uc774\ud130\ub294 \ub3d9\uc77c\ud558\uc9c0\ub9cc Post \ud14c\uc774\ube14\uc5d0 \ub300\ud55c Join \uc744 \uc218\ud589\ud558\uc9c0 \uc54a\uc73c\ubbc0\ub85c \uc131\ub2a5\uc774 \uac1c\uc120\ub420 \uac83\uc744 \uae30\ub300\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc774\ucc98\ub7fc ",(0,r.kt)("strong",{parentName:"p"},"\uac80\uc0c9 \uc870\uac74\uc5d0 \ub530\ub77c \ucffc\ub9ac \ub0b4\uc6a9\uc744 \ub2ec\ub9ac \ud560 \ud544\uc694\uc131"),"\uc744 \ub290\uaf08\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"2-\ubd88\ud544\uc694\ud55c-\uc911\ubcf5-\ub370\uc774\ud130-\uc0dd\uc131"},"2. \ubd88\ud544\uc694\ud55c \uc911\ubcf5 \ub370\uc774\ud130 \uc0dd\uc131"),(0,r.kt)("p",null,"\ub450 \ubc88\uc9f8\ub85c \ubd88\ud544\uc694\ud558\uac8c \uc911\ubcf5 \ub370\uc774\ud130\ub97c \uc0dd\uc131\ud558\ub294 \uacfc\uc815\uc744 \ubc1c\uacac\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT DISTINCT t.trip_id,\n                t.created_at,\n                t.image_url,\n                t.member_id,\n                t.name,\n                t.route_image_url,\n                t.status,\n                t.updated_at\nFROM trip t\n         JOIN point p ON t.trip_id = p.trip_id\nWHERE p.has_post = TRUE\nORDER BY t.trip_id DESC LIMIT 20;\n")),(0,r.kt)("p",null,"DISTINCT \ud0a4\uc6cc\ub4dc\ub294 \uc870\ud68c \ub370\uc774\ud130\uc758 \uc911\ubcf5\uc744 \uc81c\uac70\ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ud558\uc9c0\ub9cc Trip \ud14c\uc774\ube14\uc740 \ubcf8\ub798 \uc911\ubcf5\ub41c \ub370\uc774\ud130\ub97c \uac16\uace0 \uc788\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uadf8\ub807\ub2e4\uba74, \uc5b8\uc81c Trip\uc758 \uc911\ubcf5\uc774 \uc0dd\uae30\uace0 \uc788\uc744\uae4c\uc694?"),(0,r.kt)("p",null,"\uadf8\uac83\uc740 Trip\uacfc Point(\ud639\uc740 Post)\ub97c Join \ud560 \ub54c \uc785\ub2c8\ub2e4."),(0,r.kt)("img",{src:"https://velog.velcdn.com/images/153plane/post/2615a647-73ba-4a7f-925d-3e7915d1dcc4/image.png",width:"50%"}),(0,r.kt)("p",null,"\uc55e\uc11c \ubcf4\uc558\ub4ef Trip \uacfc Point(\ud639\uc740 Post) \ub294 1:N \uad00\uacc4\uc785\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ub530\ub77c\uc11c Trip \uacfc Point \ub97c trip_id \ub97c \uae30\uc900\uc73c\ub85c Join \ud558\uba74 \ud544\uc5f0\uc801\uc73c\ub85c Trip \ub370\uc774\ud130\uac00 \uc911\ubcf5\ub418\uac8c \ub429\ub2c8\ub2e4."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"trip_id"),(0,r.kt)("th",{parentName:"tr",align:null},"name"),(0,r.kt)("th",{parentName:"tr",align:null},"member_id"),(0,r.kt)("th",{parentName:"tr",align:null},"(...)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"query \uc5ec\ud589"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)")))),(0,r.kt)("p",null,"\ub2e4\uc74c\uacfc \uac19\uc740 Trip \ub370\uc774\ud130\uac00 1\uac1c \uc788\ub2e4\uace0 \uac00\uc815\ud574\ubd05\uc2dc\ub2e4."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"point_id"),(0,r.kt)("th",{parentName:"tr",align:null},"has_post"),(0,r.kt)("th",{parentName:"tr",align:null},"trip_id"),(0,r.kt)("th",{parentName:"tr",align:null},"latitude"),(0,r.kt)("th",{parentName:"tr",align:null},"longitude"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"2"),(0,r.kt)("td",{parentName:"tr",align:null},"0"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"0"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"5"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)")))),(0,r.kt)("p",null,"\ub9cc\uc57d \uc774 Trip \uc774 5\uac1c\uc758 Point \ub97c \uac16\uace0 \ub450 \ud14c\uc774\ube14\uc744 trip_id \ub97c \uae30\uc900\uc73c\ub85c Join \ud55c\ub2e4\uba74 \uadf8 \uacb0\uacfc\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"trip_id"),(0,r.kt)("th",{parentName:"tr",align:null},"name"),(0,r.kt)("th",{parentName:"tr",align:null},"member_id"),(0,r.kt)("th",{parentName:"tr",align:null},"(...)"),(0,r.kt)("th",{parentName:"tr",align:null},"point_id"),(0,r.kt)("th",{parentName:"tr",align:null},"has_post"),(0,r.kt)("th",{parentName:"tr",align:null},"trip_id"),(0,r.kt)("th",{parentName:"tr",align:null},"latitude"),(0,r.kt)("th",{parentName:"tr",align:null},"longitude"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"query \uc5ec\ud589"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"query \uc5ec\ud589"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"2"),(0,r.kt)("td",{parentName:"tr",align:null},"0"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"query \uc5ec\ud589"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"0"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"query \uc5ec\ud589"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"query \uc5ec\ud589"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"5"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)"),(0,r.kt)("td",{parentName:"tr",align:null},"(...)")))),(0,r.kt)("p",null,"trip_id \uac00 1\uc778 Trip \uc774 5\uac1c\uae4c\uc9c0 \ub298\uc5b4\ub09c \uac83\uc744 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"Trip \uc744 \uc870\ud68c\ud558\uae30 \uc704\ud574 \uad73\uc774 ",(0,r.kt)("strong",{parentName:"p"},"Trip \ub370\uc774\ud130\ub97c \uc911\ubcf5 \uc0dd\uc131\ud558\ub294 \uacfc\uc815\uc744 \uacaa\uc744 \ud544\uc694\ub294 \uc5c6\ub2e4"),"\uace0 \uc0dd\uac01\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ub530\ub77c\uc11c Trip \uacfc Point \ub97c Join \ud558\uae30 \uc804\uc5d0 Point \ud14c\uc774\ube14\uc5d0\uc11c trip_id \uc758 \uc911\ubcf5\uc744 \uc81c\uac70\ud558\ub294 \ubc29\ubc95\uc744 \ub5a0\uc62c\ub838\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"1:N \uad00\uacc4\uc758 \ub450 \ud14c\uc774\ube14\uc5d0\uc11c N \ud14c\uc774\ube14\uc5d0 DISTINCT \ud0a4\uc6cc\ub4dc\ub97c \uc801\uc6a9\ud558\ub294 \uac83\uc774\uc5c8\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h2",{id:"\ucffc\ub9ac-\ubcc0\uacbd"},"\ucffc\ub9ac \ubcc0\uacbd"),(0,r.kt)("p",null,"\ucffc\ub9ac\ub97c \uc0b4\ud3b4\ubcf4\uba70 \uae68\ub2ec\uc740 \ub450 \uac00\uc9c0\ub97c \uc815\ub9ac\ud558\uba74 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\uac80\uc0c9 \uc870\uac74\uc5d0 \ub530\ub77c \ucffc\ub9ac \ub0b4\uc6a9\uc744 \ub2e4\ub974\uac8c \ud55c\ub2e4."),(0,r.kt)("li",{parentName:"ul"},"Trip\uc758 \uc911\ubcf5\uc744 \ub9c9\uae30 \uc704\ud574 Point \ub370\uc774\ud130\uc5d0 \ubbf8\ub9ac DISTINCT \ud0a4\uc6cc\ub4dc\ub97c \uc801\uc6a9\ud55c\ub2e4.")),(0,r.kt)("h3",{id:"subquery"},"Subquery"),(0,r.kt)("p",null,'"Trip\uc758 \uc911\ubcf5\uc744 \ub9c9\uae30 \uc704\ud574 Point \ub370\uc774\ud130\uc5d0 \ubbf8\ub9ac DISTINCT \ud0a4\uc6cc\ub4dc\ub97c \uc801\uc6a9\ud55c\ub2e4." \ub97c \uc704\ud574 Subquery \ub97c \ub3c4\uc785\ud558\uace0\uc790 \ud588\uc2b5\ub2c8\ub2e4.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT DISTINCT t.trip_id,\n                t.created_at,\n                t.image_url,\n                t.member_id,\n                t.name,\n                t.route_image_url,\n                t.status,\n                t.updated_at\nFROM trip t\nWHERE t.trip_id IN (\n    SELECT DISTINCT p.trip_id\n    FROM point p\n    WHERE p.has_post = TRUE\n    )\nORDER BY t.trip_id DESC\nLIMIT 20;\n")),(0,r.kt)("p",null,"Subquery \uc5d0\uc11c Point\uc758 trip_id\ub97c \uc870\ud68c\ud569\ub2c8\ub2e4. \uc774\ub54c DISTINCT \ub85c \uc911\ubcf5\uc744 \ubbf8\ub9ac \uc81c\uac70\ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ub2e8\uc21c\ud788 \uc911\ubcf5\uc744 \ubbf8\ub9ac \uc81c\uac70\ud558\ub294 \uac83\ub9cc\uc73c\ub85c\ub3c4 \ucffc\ub9ac \uc2dc\uac04\uc774 \uc57d 600ms\uc5d0\uc11c 60ms \ub85c \ub2e8\ucd95\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uadf8\ub7ec\ub098 \ucffc\ub9ac\uc5d0\uc11c \uac1c\uc120\ud560 \uc218 \uc788\ub294 \uc810\uc774 \ud55c \uac00\uc9c0 \ub354 \ubcf4\uc600\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ubc14\ub85c LIMIT \uc785\ub2c8\ub2e4."),(0,r.kt)("p",null,"IN \uc808\uc5d0\uc11c \ube44\uad50\ud560 trip_id\uc758 \uac1c\uc218\ub97c \ubbf8\ub9ac \uc904\uc778\ub2e4\uba74 \uc131\ub2a5\uc744 \ub354\uc6b1 \ub192\uc77c \uc218 \uc788\uc744 \uac83\uc774\ub77c \uc608\uc0c1\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT DISTINCT t.trip_id,\n                t.created_at,\n                t.image_url,\n                t.member_id,\n                t.name,\n                t.route_image_url,\n                t.status,\n                t.updated_at\nFROM trip t\nWHERE t.trip_id IN (\n    SELECT DISTINCT poi.trip_id\n    FROM point poi\n    WHERE poi.has_post = TRUE\n    ORDER BY poi.trip_id DESC\n    LIMIT 20\n    )\nORDER BY t.trip_id DESC;\n")),(0,r.kt)("p",null,"\ub530\ub77c\uc11c \uc704\uc640 \uac19\uc740 \ucffc\ub9ac\ub97c \uc2e4\ud589\ud558\uace0 \uc2f6\uc5c8\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ud558\uc9c0\ub9cc ",(0,r.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/subquery-restrictions.html"},"MySql \uacf5\uc2dd\ubb38\uc11c"),"\uc5d0 \ub530\ub974\uba74 subquery \ub0b4\uc5d0\uc11c LIMIT\uc744 \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://velog.velcdn.com/images/153plane/post/8cac8d44-2775-43f6-b48a-7689d88f9800/image.png",alt:null})),(0,r.kt)("h3",{id:"\ucffc\ub9ac-\ub098\ub204\uae30"},"\ucffc\ub9ac \ub098\ub204\uae30"),(0,r.kt)("p",null,"\ub530\ub77c\uc11c Subquery\ub97c \uc0ac\uc6a9\ud558\uae30\ubcf4\ub2e4 \ucffc\ub9ac\ub97c \ub450 \uac1c\ub85c \ub098\ub220\ubcf4\uae30\ub85c \ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc774\uac83\uc774 \uccab \ubc88\uc9f8 \ucffc\ub9ac\uc785\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT DISTINCT p.trip_id\nFROM point p\nWHERE p.has_post = TRUE\nORDER BY p.trip_id DESC\nLIMIT 20;\n")),(0,r.kt)("p",null,"\uadf8\ub9ac\uace0 \ub450 \ubc88\uc9f8 \ucffc\ub9ac\uc785\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT t.trip_id,\n       t.created_at,\n       t.image_url,\n       t.member_id,\n       t.name,\n       t.route_image_url,\n       t.status,\n       t.updated_at\nFROM trip t\nWHERE t.trip_id IN (?)\nORDER BY t.trip_id DESC;\n")),(0,r.kt)("p",null,"IN() \uc548\uc5d0 \uccab \ubc88\uc9f8 \ucffc\ub9ac\ub85c \ubc18\ud658\ub41c trip_id\uac00 \uc785\ub825\ub429\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ucffc\ub9ac\ub97c \ub450 \ubc88 \ub098\ub204\uc5c8\uc744 \ub54c \uc2dc\uac04\uc740 ",(0,r.kt)("strong",{parentName:"p"},"\ud3c9\uade0 13ms\uae4c\uc9c0 \ub2e8\ucd95"),"\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"\uc870\uac74\uc5d0-\ub530\ub77c-query-\ub098\ub204\uae30"},"\uc870\uac74\uc5d0 \ub530\ub77c Query \ub098\ub204\uae30"),(0,r.kt)("p",null,"\uc774\ud6c4 \uac80\uc0c9 \uc870\uac74\uc5d0 \ub530\ub77c \ucffc\ub9ac\ub97c \ub098\ub204\uc5c8\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uac80\uc0c9 \uc870\uac74\uc5d0 \ub530\ub77c \ub2e4\ub8e8\uc5b4\uc57c \ud560 \ud14c\uc774\ube14 \ud639\uc740 \ub370\uc774\ud130\uc758 \ub0b4\uc6a9\uc774 \ub2e4\ub985\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc870\uac74\ubcc4\ub85c \ud544\uc694\ud55c \ub370\uc774\ud130\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\uac80\uc0c9 \uc870\uac74\uc774 \uc5c6\ub294 \uacbd\uc6b0 : point.has_post"),(0,r.kt)("li",{parentName:"ul"},"\uc2dc\uac04 \uc870\uac74\ub9cc \uc788\ub294 \uacbd\uc6b0 : point.recorded_at, point.has_post"),(0,r.kt)("li",{parentName:"ul"},"\uc8fc\uc18c \uc870\uac74\ub9cc \uc788\ub294 \uacbd\uc6b0 : post.address"),(0,r.kt)("li",{parentName:"ul"},"\ubaa8\ub4e0 \uc870\uac74\uc774 \uc788\ub294 \uacbd\uc6b0 : point.recorded_at, post.address")),(0,r.kt)("h4",{id:"\uac80\uc0c9-\uc870\uac74\uc774-\uc5c6\ub294-\uacbd\uc6b0-1"},"\uac80\uc0c9 \uc870\uac74\uc774 \uc5c6\ub294 \uacbd\uc6b0"),(0,r.kt)("p",null,"\uc870\uac74\uc774 \uc5c6\ub294 \uacbd\uc6b0, \uc5ec\ud589 \uc804\uccb4\ub97c \uc870\ud68c\ud558\uae30 \uc704\ud574 \ud544\uc694\ud55c \ub370\uc774\ud130\ub294 Point \ud14c\uc774\ube14\uc758 has_post \uceec\ub7fc\uc785\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ub530\ub77c\uc11c Trip\uacfc Point \ud14c\uc774\ube14\ub9cc \ub2e4\ub8e8\ub3c4\ub85d \ud569\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT DISTINCT p.trip_id\nFROM point p\nWHERE p.has_post = TRUE\nORDER BY p.trip_id DESC\nLIMIT 20;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT t.trip_id,\n       t.created_at,\n       t.image_url,\n       t.member_id,\n       t.name,\n       t.route_image_url,\n       t.status,\n       t.updated_at\nFROM trip t\nWHERE t.trip_id IN (?)\nORDER BY t.trip_id DESC;\n")),(0,r.kt)("p",null,"\uc55e\uc11c \uc124\uba85\ud588\ub4ef \uccab \ubc88\uc9f8 \ucffc\ub9ac\uc758 \uacb0\uacfc\uac00 \ub450 \ubc88\uc9f8 \ucffc\ub9ac\uc758 IN () \uc548\uc5d0 \uc778\uc790\ub85c \ub4e4\uc5b4\uac11\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc55e\uc73c\ub85c \ubaa8\ub4e0 \uc870\uac74\uc5d0\uc11c \uccab \ubc88\uc9f8 \ucffc\ub9ac\ub294 \ub2ec\ub77c\uc9c0\uc9c0\ub9cc, \ub450 \ubc88\uc9f8 \ucffc\ub9ac\ub294 \ub2ec\ub77c\uc9c0\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ub530\ub77c\uc11c \uccab \ubc88\uc9f8 \ucffc\ub9ac\ub9cc \uc608\uc2dc\ub85c \ub4e4\uaca0\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h4",{id:"\uc2dc\uac04-\uc870\uac74\ub9cc-\uc788\ub294-\uacbd\uc6b0"},"\uc2dc\uac04 \uc870\uac74\ub9cc \uc788\ub294 \uacbd\uc6b0"),(0,r.kt)("p",null,"\uc2dc\uac04 \uc870\uac74\ub9cc \uc788\ub294 \uacbd\uc6b0 \uc5ec\ud589 \uc804\uccb4\ub97c \uc870\ud68c\ud558\uae30 \uc704\ud574 \ud544\uc694\ud55c \ub370\uc774\ud130\ub294 Point \ud14c\uc774\ube14\uc758 recorded_at, has_post \uceec\ub7fc\uc785\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ub530\ub77c\uc11c Trip\uacfc Point \ud14c\uc774\ube14\ub9cc \ub2e4\ub8e8\ub3c4\ub85d \ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc694\uc77c \uc870\uac74\uc774 \ud3ec\ud568\ub41c \uccab \ubc88\uc9f8 \ucffc\ub9ac \uc608\uc2dc\uc785\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT DISTINCT p.trip_id\nFROM point p\nWHERE dayofweek(p.recorded_at) = 1 AND p.has_post = TRUE\nORDER BY p.trip_id DESC\nLIMIT 20;\n")),(0,r.kt)("p",null,"\ub450 \ubc88\uc9f8 \ucffc\ub9ac\ub294 \uac80\uc0c9 \uc870\uac74\uc774 \uc5c6\ub294 \uacbd\uc6b0\uc640 \ub3d9\uc77c\ud569\ub2c8\ub2e4."),(0,r.kt)("h4",{id:"\uc8fc\uc18c-\uc870\uac74\ub9cc-\uc788\ub294-\uacbd\uc6b0"},"\uc8fc\uc18c \uc870\uac74\ub9cc \uc788\ub294 \uacbd\uc6b0"),(0,r.kt)("p",null,"\uc8fc\uc18c \uc870\uac74\ub9cc \uc788\ub294 \uacbd\uc6b0 \uc5ec\ud589 \uc804\uccb4\ub97c \uc870\ud68c\ud558\uae30 \uc704\ud574 \ud544\uc694\ud55c \ub370\uc774\ud130\ub294 Post \ud14c\uc774\ube14\uc758 address \uceec\ub7fc\uc785\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ub530\ub77c\uc11c Trip\uacfc Post \ud14c\uc774\ube14\ub9cc \uc791\uc5c5\ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc8fc\uc18c \uc870\uac74\uc774 \ud3ec\ud568\ub41c \uccab \ubc88\uc9f8 \ucffc\ub9ac \uc608\uc2dc\uc785\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT DISTINCT p.trip_id\nFROM post p\nWHERE p.address LIKE '\uc11c\uc6b8\ud2b9\ubcc4\uc2dc%' ESCAPE '!'\nORDER BY p.trip_id DESC\nLIMIT 20;\n")),(0,r.kt)("p",null,"\ub450 \ubc88\uc9f8 \ucffc\ub9ac\ub294 \uac80\uc0c9 \uc870\uac74\uc774 \uc5c6\ub294 \uacbd\uc6b0\uc640 \ub3d9\uc77c\ud569\ub2c8\ub2e4."),(0,r.kt)("h4",{id:"\uc2dc\uac04-\uc870\uac74-\uc8fc\uc18c-\uc870\uac74\uc774-\ubaa8\ub450-\uc788\ub294-\uacbd\uc6b0"},"\uc2dc\uac04 \uc870\uac74, \uc8fc\uc18c \uc870\uac74\uc774 \ubaa8\ub450 \uc788\ub294 \uacbd\uc6b0"),(0,r.kt)("p",null,"\uc2dc\uac04 \uc870\uac74, \uc8fc\uc18c \uc870\uac74\uc774 \ubaa8\ub450 \uc788\ub294 \uacbd\uc6b0 Post.address, Point.recorded_at \uceec\ub7fc\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ub530\ub77c\uc11c Trip\uacfc Post, Point \ud14c\uc774\ube14\uc744 \uc791\uc5c5\ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc2dc\uac04 \uc870\uac74\uacfc \uc8fc\uc18c \uc870\uac74\uc774 \ud3ec\ud568\ub41c \uccab \ubc88\uc9f8 \ucffc\ub9ac \uc608\uc2dc\uc785\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT DISTINCT poi.trip_id\nFROM point poi\nJOIN post ps on poi.point_id = ps.point_id\nWHERE (dayofweek(poi.recorded_at) = 1 AND ps.address LIKE '\uc11c\uc6b8\ud2b9\ubcc4\uc2dc%' ESCAPE '!')\nORDER BY poi.trip_id DESC LIMIT 20;\n")),(0,r.kt)("p",null,"\ub450 \ubc88\uc9f8 \ucffc\ub9ac\ub294 \uac80\uc0c9 \uc870\uac74\uc774 \uc5c6\ub294 \uacbd\uc6b0\uc640 \ub3d9\uc77c\ud569\ub2c8\ub2e4."),(0,r.kt)("h2",{id:"querydsl-\ucf54\ub4dc"},"QueryDsl \ucf54\ub4dc"),(0,r.kt)("p",null,"\uae30\uc874\uc5d0 \ud558\ub098\uc600\ub358 \ucffc\ub9ac\ub97c \ub450 \uac1c\ub85c \ub098\ub204\uace0, \uac80\uc0c9 \uc870\uac74\uc5d0 \ub530\ub77c \ucffc\ub9ac\ub97c \ub2ec\ub9ac\ud55c \uac83\uc740 \ubaa8\ub450 QueryDsl\uacfc Java \ucf54\ub4dc\ub85c \uad6c\ud604\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc774\uc804\uc5d0 \ube44\ud574 \ucf54\ub4dc\uac00 \ubcf5\uc7a1\ud574\uc9c8 \uac83\uc744 \uc5fc\ub824\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ub530\ub77c\uc11c \uba54\uc11c\ub4dc\uc758 \uc774\ub984\uc744 \ud1b5\ud574 \uc758\ub3c4\uac00 \uc798 \ub4dc\ub7ec\ub098\ub3c4\ub85d \ub178\ub825\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uadf8 \uacb0\uacfc\ubb3c\uc740 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@RequiredArgsConstructor\n@Repository\npublic class TripDynamicQueryRepository {\n\n    private final JPAQueryFactory jpaQueryFactory;\n\n    public List<Trip> findAllByConditions(TripSearchConditions tripSearchConditions, TripPaging paging) {\n        if (tripSearchConditions.hasNoCondition()) {\n            List<Long> tripIds = getTripIdsWithoutCondition(paging);\n            return getTripsIn(tripIds);\n        }\n\n        if (tripSearchConditions.hasOnlyAddressCondition()) {\n            List<Long> tripIds = getTripIdsWithAddressCondition(tripSearchConditions, paging);\n            return getTripsIn(tripIds);\n        }\n\n        if (tripSearchConditions.hasOnlyTimeConditions()) {\n            List<Long> tripIds = getTripIdsWithTimeConditions(tripSearchConditions, paging);\n            return getTripsIn(tripIds);\n        }\n\n        List<Long> tripIds = getTripIdsWithAllConditions(tripSearchConditions, paging);\n        return getTripsIn(tripIds);\n    }\n\n    private List<Long> getTripIdsWithoutCondition(TripPaging paging) {\n        return jpaQueryFactory.selectDistinct(point.trip.id).from(point)\n                .where(\n                        point.hasPost.isTrue(),\n                        pointTripIdLt(paging.lastViewedId())\n                )\n                .orderBy(point.trip.id.desc())\n                .limit(paging.limit().longValue())\n                .fetch();\n    }\n\n    private List<Trip> getTripsIn(List<Long> tripIds) {\n        return jpaQueryFactory.selectFrom(trip)\n                .where(trip.id.in(tripIds))\n                .orderBy(trip.id.desc())\n                .fetch();\n    }\n\n    private List<Long> getTripIdsWithAddressCondition(TripSearchConditions tripSearchConditions, TripPaging paging) {\n        return jpaQueryFactory.selectDistinct(post.tripId).from(post)\n                .where(\n                        addressLike(tripSearchConditions.address()),\n                        postTripIdLt(paging.lastViewedId())\n                )\n                .orderBy(post.tripId.desc())\n                .limit(paging.limit().longValue())\n                .fetch();\n    }\n\n    private List<Long> getTripIdsWithTimeConditions(TripSearchConditions tripSearchConditions, TripPaging paging) {\n        return jpaQueryFactory.selectDistinct(point.trip.id).from(point)\n                .where(\n                        yearIn(tripSearchConditions.years()),\n                        monthIn(tripSearchConditions.months()),\n                        dayOfWeekIn(tripSearchConditions.daysOfWeek()),\n                        point.hasPost.isTrue(),\n                        pointTripIdLt(paging.lastViewedId())\n                )\n                .orderBy(point.trip.id.desc())\n                .limit(paging.limit().longValue())\n                .fetch();\n    }\n\n    private List<Long> getTripIdsWithAllConditions(TripSearchConditions tripSearchConditions, TripPaging paging) {\n        return jpaQueryFactory.selectDistinct(point.trip.id).from(point)\n                .innerJoin(post).on(post.point.id.eq(point.id))\n                .where(\n                        yearIn(tripSearchConditions.years()),\n                        monthIn(tripSearchConditions.months()),\n                        dayOfWeekIn(tripSearchConditions.daysOfWeek()),\n                        addressLike(tripSearchConditions.address()),\n                        pointTripIdLt(paging.lastViewedId())\n                )\n                .orderBy(point.trip.id.desc())\n                .limit(paging.limit().longValue())\n                .fetch();\n    }\n}\n\n")),(0,r.kt)("h2",{id:"\uacb0\uacfc"},"\uacb0\uacfc"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://velog.velcdn.com/images/153plane/post/4efb5adc-094d-4d82-a169-8b03464daa8c/image.png",alt:null})),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\ubaa8\ub4e0 \uc5ec\ud589 \uc870\ud68c API"),"\uc758 \uc694\uccad \ucc98\ub9ac \uc2dc\uac04\uc740 \uac80\uc0c9 \uc870\uac74\uc774 \uc5c6\ub294 \uacbd\uc6b0 \uc57d 13ms\ub97c \uae30\ub85d\ud558\uba70 \ub9e4\uc6b0 \ube68\ub77c\uc84c\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,'\uac80\uc0c9 \uc870\uac74\uc774 \uc788\ub294 \uacbd\uc6b0\uc5d0\ub3c4 \uc6d4\ub4f1\ud788 \ube68\ub77c\uc84c\uc2b5\ub2c8\ub2e4. \uac00\ub839, "1\uc6d4" \uc744 \uc2dc\uac04 \uc870\uac74\uc73c\ub85c \ud3ec\ud568\ud588\uc744 \ub54c \uc57d 100ms -> 12ms \ub85c \ub2e8\ucd95 \ub410\uc2b5\ub2c8\ub2e4.'),(0,r.kt)("p",null,"\uc0ac\uc6a9\uc790 \ud639\uc740 DB\uc5d0 \ub370\uc774\ud130\uac00 \ub9ce\uc544\uc9c4\ub2e4\uba74 \ub610 \uc0c8\ub86d\uac8c \uc870\ud68c \uc131\ub2a5\uc744 \ub192\uc77c \ubc29\ubc95\uc744 \uac15\uad6c\ud574\ubcfc \uc218\ub3c4 \uc788\uaca0\uc2b5\ub2c8\ub2e4!"))}m.isMDXComponent=!0}}]);