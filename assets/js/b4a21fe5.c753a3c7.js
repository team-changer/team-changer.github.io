"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[925],{3905:(e,n,t)=>{t.d(n,{Zo:()=>s,kt:()=>h});var r=t(7294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,r,l=function(e,n){if(null==e)return{};var t,r,l={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var p=r.createContext({}),c=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},s=function(e){var n=c(e.components);return r.createElement(p.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},g=r.forwardRef((function(e,n){var t=e.components,l=e.mdxType,i=e.originalType,p=e.parentName,s=a(e,["components","mdxType","originalType","parentName"]),u=c(t),g=l,h=u["".concat(p,".").concat(g)]||u[g]||d[g]||i;return t?r.createElement(h,o(o({ref:n},s),{},{components:t})):r.createElement(h,o({ref:n},s))}));function h(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var i=t.length,o=new Array(i);o[0]=g;var a={};for(var p in n)hasOwnProperty.call(n,p)&&(a[p]=n[p]);a.originalType=e,a[u]="string"==typeof e?e:l,o[1]=a;for(var c=2;c<i;c++)o[c]=t[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}g.displayName="MDXCreateElement"},9035:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var r=t(7462),l=(t(7294),t(3905));const i={title:"\ubb34\uc911\ub2e8 \ubc30\ud3ec \uacfc\uc815",slug:"nonstop-deploy",authors:["reo"],tags:["\ubb34\uc911\ub2e8\ubc30\ud3ec","\ube14\ub8e8-\uadf8\ub9b0"]},o=void 0,a={permalink:"/nonstop-deploy",editUrl:"https://github.com/trip-draw/trip-draw.github.io/tree/main/blog/2023-10-16-\ubb34\uc911\ub2e8-\ubc30\ud3ec/2023-10-16-\ubb34\uc911\ub2e8-\ubc30\ud3ec.mdx",source:"@site/blog/2023-10-16-\ubb34\uc911\ub2e8-\ubc30\ud3ec/2023-10-16-\ubb34\uc911\ub2e8-\ubc30\ud3ec.mdx",title:"\ubb34\uc911\ub2e8 \ubc30\ud3ec \uacfc\uc815",description:"\ubb34\uc911\ub2e8 \ubc30\ud3ec \uacfc\uc815\uc744 \uc124\uba85\ud55c\ub2e4.",date:"2023-10-16T00:00:00.000Z",formattedDate:"2023\ub144 10\uc6d4 16\uc77c",tags:[{label:"\ubb34\uc911\ub2e8\ubc30\ud3ec",permalink:"/tags/\ubb34\uc911\ub2e8\ubc30\ud3ec"},{label:"\ube14\ub8e8-\uadf8\ub9b0",permalink:"/tags/\ube14\ub8e8-\uadf8\ub9b0"}],readingTime:7.69,hasTruncateMarker:!1,authors:[{name:"\ub9ac\uc624",title:"Backend",url:"https://github.com/Jaeyoung22",imageURL:"https://github.com/Jaeyoung22.png",key:"reo"}],frontMatter:{title:"\ubb34\uc911\ub2e8 \ubc30\ud3ec \uacfc\uc815",slug:"nonstop-deploy",authors:["reo"],tags:["\ubb34\uc911\ub2e8\ubc30\ud3ec","\ube14\ub8e8-\uadf8\ub9b0"]},prevItem:{title:"HikariCP \uc124\uc815",permalink:"/hikari-cp"},nextItem:{title:"\uc2a4\ud504\ub9c1 \ud14c\uc2a4\ud2b8 \uaca9\ub9ac",permalink:"/spring-test-isolation"}},p={authorsImageUrls:[void 0]},c=[{value:"\ubc30\ud3ec \ubc29\uc2dd",id:"\ubc30\ud3ec-\ubc29\uc2dd",level:2},{value:"\uc0c1\uc138 \uacfc\uc815",id:"\uc0c1\uc138-\uacfc\uc815",level:2},{value:"\uc18c\uc2a4 \ud30c\uc77c \ucd94\uac00",id:"\uc18c\uc2a4-\ud30c\uc77c-\ucd94\uac00",level:3},{value:"\uc11c\ubc84 \uc124\uc815 \ubcc0\uacbd",id:"\uc11c\ubc84-\uc124\uc815-\ubcc0\uacbd",level:3},{value:"1. nginx\uac00 service-url.inc \ub0b4\ubd80\uc5d0\uc11c \uc815\uc758\ub41c \ud3ec\ud2b8\ub97c \uc774\uc6a9\ud558\ub3c4\ub85d \uc124\uc815\ud55c\ub2e4.",id:"1-nginx\uac00-service-urlinc-\ub0b4\ubd80\uc5d0\uc11c-\uc815\uc758\ub41c-\ud3ec\ud2b8\ub97c-\uc774\uc6a9\ud558\ub3c4\ub85d-\uc124\uc815\ud55c\ub2e4",level:4},{value:"2. \ubc30\ud3ec \uc2a4\ud06c\ub9bd\ud2b8\uc5d0\uc11c \ud604\uc7ac \uc11c\ube44\uc2a4 \uc911\uc778 \uc2a4\ud504\ub9c1\ubd80\ud2b8\uc758 \ud504\ub85c\ud30c\uc77c\uc744 \ud655\uc778\ud558\uc5ec \ubc30\ud3ec\ub420 \uc2a4\ud504\ub9c1\ubd80\ud2b8\uc758 \ud504\ub85c\ud30c\uc77c\uacfc \ud3ec\ud2b8\ub97c \uc124\uc815\ud55c\ub2e4.",id:"2-\ubc30\ud3ec-\uc2a4\ud06c\ub9bd\ud2b8\uc5d0\uc11c-\ud604\uc7ac-\uc11c\ube44\uc2a4-\uc911\uc778-\uc2a4\ud504\ub9c1\ubd80\ud2b8\uc758-\ud504\ub85c\ud30c\uc77c\uc744-\ud655\uc778\ud558\uc5ec-\ubc30\ud3ec\ub420-\uc2a4\ud504\ub9c1\ubd80\ud2b8\uc758-\ud504\ub85c\ud30c\uc77c\uacfc-\ud3ec\ud2b8\ub97c-\uc124\uc815\ud55c\ub2e4",level:4},{value:"3. switch.sh\uc5d0\uc11c service-url.inc \ub0b4\ubd80\uc758 \ud3ec\ud2b8\ub97c \ubcc0\uacbd\ud55c\ub2e4.",id:"3-switchsh\uc5d0\uc11c-service-urlinc-\ub0b4\ubd80\uc758-\ud3ec\ud2b8\ub97c-\ubcc0\uacbd\ud55c\ub2e4",level:4}],s={toc:c},u="wrapper";function d(e){let{components:n,...t}=e;return(0,l.kt)(u,(0,r.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"\ubb34\uc911\ub2e8 \ubc30\ud3ec \uacfc\uc815\uc744 \uc124\uba85\ud55c\ub2e4."),(0,l.kt)("h2",{id:"\ubc30\ud3ec-\ubc29\uc2dd"},"\ubc30\ud3ec \ubc29\uc2dd"),(0,l.kt)("p",null,"\ubb34\uc911\ub2e8 \ubc30\ud3ec \ubc29\uc2dd\uc5d0\ub294 \uc5ec\ub7ec \uc885\ub958\uac00 \uc788\uc73c\ub098, \ud604\uc7ac\uc758 \uc81c\ud55c\ub41c \uc778\uc2a4\ud134\uc2a4 \ud658\uacbd\uc5d0\uc11c \uac00\uc7a5 \ucd5c\uc801\uc758 \ubc29\uc2dd\uc774 \ud3ec\ud2b8 \ud560\ub2f9 \ubc29\uc2dd\uc758 \ube14\ub8e8-\uadf8\ub9b0 \ubc29\uc2dd\uc774\ub77c\uace0 \ud310\ub2e8\ud588\ub2e4. \uae30\uc874\uc5d0 \uc0ac\uc6a9\ud558\ub358 EC2\uc5d0 \uadf8\ub300\ub85c \uc801\uc6a9\ud558\uae30 \ub54c\ubb38\uc5d0 \uac00\uc7a5 \uc800\ub834\ud55c \ubc29\uc2dd\uc774\uae30\ub3c4 \ud558\ub2e4.\n\ud558\ub098\uc758 \uc778\uc2a4\ud134\uc2a4 \ub0b4\uc5d0\uc11c \ub450 \uac1c\uc758 WAS\uc5d0 \uac01\uac01 \ub2e4\ub978 \ud3ec\ud2b8\ub97c \ud560\ub2f9\ud558\uc5ec \uc9c4\ud589\ud55c\ub2e4. \uc0c1\uc138\ud55c \uc9c4\ud589 \uacfc\uc815\uc740 \uc544\ub798\uc640 \uac19\ub2e4."),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"EC2(\ub9ac\ub205\uc2a4 \uc11c\ubc84)\uc5d0 Nginx 1\ub300\uc640 \uc2a4\ud504\ub9c1\ubd80\ud2b8 jar 2\uac1c\ub97c \uc0ac\uc6a9\ud55c\ub2e4.\n-> Nginx\ub294 80(http), 443(https) \ud3ec\ud2b8\ub97c \uc0ac\uc6a9\ud558\uace0 8080(\uc2a4\ud504\ub9c1\ubd80\ud2b81), 8081(\uc2a4\ud504\ub9c1\ubd80\ud2b82)\uc5d0 \ud3ec\ud2b8 \ud3ec\uc6cc\ub529\uc744 \ud55c\ub2e4."),(0,l.kt)("li",{parentName:"ol"},"\uc0ac\uc6a9\uc790\ub294 \uc11c\ube44\uc2a4 \uc8fc\uc18c\ub85c \uc811\uc18d\ud55c\ub2e4 (80 \ub610\ub294 443 \ud3ec\ud2b8)"),(0,l.kt)("li",{parentName:"ol"},"Nginx\ub294 \uc0ac\uc6a9\uc790\uc758 \uc694\uccad\uc744 \ubc1b\uc544\xa0",(0,l.kt)("strong",{parentName:"li"},"\ud604\uc7ac \uc5f0\uacb0\ub41c \uc2a4\ud504\ub9c1\ubd80\ud2b8\ub85c \uc694\uccad\uc744 \uc804\ub2ec"),"\ud55c\ub2e4."),(0,l.kt)("li",{parentName:"ol"},"\ubc30\ud3ec\uac00 \ud544\uc694\ud558\uba74\xa0",(0,l.kt)("strong",{parentName:"li"},"Nginx\uc640 \uc5f0\uacb0\ub418\uc9c0 \uc54a\uc740"),"\xa0\uc2a4\ud504\ub9c1\ubd80\ud2b8\ub85c \ubc30\ud3ec\ud55c\ub2e4."),(0,l.kt)("li",{parentName:"ol"},"\uc0c8\ub85c \ubc30\ud3ec\ub418\ub294 \uc2a4\ud504\ub9c1\ubd80\ud2b8\ub294 \ud604\uc7ac \uc5f0\uacb0\ub41c \uc2a4\ud504\ub9c1\ubd80\ud2b8\uc640 ",(0,l.kt)("strong",{parentName:"li"},"\ub2e4\ub978 \ud504\ub85c\ud30c\uc77c\uc744 \uc0ac\uc6a9\ud55c\ub2e4.")),(0,l.kt)("li",{parentName:"ol"},"\ubc30\ud3ec\uac00 \ub05d\ub098\uace0 \uc815\uc0c1\uc801\uc73c\ub85c \ubc30\ud3ec\ub97c \ud55c \uc2a4\ud504\ub9c1\ubd80\ud2b8\uac00 \uad6c\ub3d9\uc911\uc778\uc9c0 \ud655\uc778\ud55c\ub2e4."),(0,l.kt)("li",{parentName:"ol"},"5\uc5d0\uc11c \ud655\uc778\ud55c \uc2a4\ud504\ub9c1\ubd80\ud2b8\uac00 \uc815\uc0c1 \uad6c\ub3d9\uc911\uc774\uba74\xa0",(0,l.kt)("inlineCode",{parentName:"li"},"nginx reload"),"\ub97c \ud1b5\ud574 \ud574\ub2f9 \uc2a4\ud504\ub9c1\ubd80\ud2b8\uc758 \ud3ec\ud2b8\ub97c nginx\uac00 \uc5f0\uacb0\ud558\ub3c4\ub85d \ud55c\ub2e4."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Nginx Reload\ub294 1\ucd08 \uc774\ub0b4\uc5d0 \uc2e4\ud589\uc774 \uc644\ub8cc\ub41c\ub2e4")),(0,l.kt)("li",{parentName:"ol"},"\uc774 \ub54c, \ud504\ub85c\ud30c\uc77c \ubcc4\ub85c \ubd84\uae30\ub97c \ud0c0\uc11c \ud3ec\ud2b8 \ud3ec\uc6cc\ub529\uc744 \uc9c4\ud589\ud55c\ub2e4."),(0,l.kt)("li",{parentName:"ol"},"\ub9cc\uc57d \ubc30\ud3ec\uc2dc \ubb38\uc81c\uac00 \uc0dd\uaca8\uc11c rollback\uc774 \ud544\uc694\ud558\uba74 ngix\uac00 \ubc30\ud3ec\uc804\uc5d0 \uc5f0\uacb0\ub418\uc5c8\ub358 \uc2a4\ud504\ub9c1\ubd80\ud2b8\ub97c \ub2e4\uc2dc \uc5f0\uacb0\ud55c\ub2e4.")),(0,l.kt)("br",null),(0,l.kt)("h2",{id:"\uc0c1\uc138-\uacfc\uc815"},"\uc0c1\uc138 \uacfc\uc815"),(0,l.kt)("p",null,"\uc0c1\uc138 \uacfc\uc815\uc740 \uc544\ub798\uc640 \uac19\ub2e4."),(0,l.kt)("h3",{id:"\uc18c\uc2a4-\ud30c\uc77c-\ucd94\uac00"},"\uc18c\uc2a4 \ud30c\uc77c \ucd94\uac00"),(0,l.kt)("p",null,"\uc6b0\uc120, \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc0ac\uc6a9\ud560 \ud504\ub85c\ud30c\uc77c\uc744 \uc120\ud0dd\ud558\uae30 \uc704\ud574 \ud604\uc7ac \ud504\ub85c\ud30c\uc77c\uc744 \ud655\uc778\ud558\ub294 API\ub97c \uad6c\ud604\ud55c\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@RequiredArgsConstructor\n@RequestMapping("/profile")\n@RestController\npublic class ProfileController {\n\nprivate final Environment environment;\n\n    @GetMapping\n    public String readProfile() {\n        return Arrays.stream(environment.getActiveProfiles())\n                .findFirst()\n                .orElse("");\n    }\n}\n\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'class ProfileControllerTest extends ControllerTest {\n\n@Test\nvoid \ud604\uc7ac_\ud504\ub85c\ud30c\uc77c\uc744_\uc77d\ub294\ub2e4() {\n    // when\n    String profile = RestAssured.given().log().all()\n            .when().get("/profile")\n            .then().log().all()\n            .statusCode(OK.value())\n            .extract().asString();\n\n    // then\n    assertThat(profile).isEqualTo("local");\n    }\n}\n\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Override\npublic void addInterceptors(InterceptorRegistry registry) {\n        registry.addInterceptor(authInterceptor)\n        // ...\n        .excludePathPatterns("/profile");\n        // ...\n}\n\n')),(0,l.kt)("p",null,"\uc774\uc81c \ud604\uc7ac \uc0ac\uc6a9\uc911\uc778 \ud504\ub85c\ud30c\uc77c\uc744 \ubc18\ud658\ud560 \uc218 \uc788\uac8c \ub418\uc5c8\ub2e4."),(0,l.kt)("br",null),(0,l.kt)("p",null,"\ub2e4\uc74c\uc73c\ub85c, \ud504\ub85c\ud30c\uc77c \ubcc4\ub85c \uc0ac\uc6a9\ud560 \ud3ec\ud2b8\ub97c application.yml\uc5d0\uc11c \uc9c0\uc815\ud574\uc8fc\uc790."),(0,l.kt)("p",null,"application-prod1.yml"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"spring:\n    profiles: prod1\n\n// ...\n\nserver:\n    port: 8080\n\n")),(0,l.kt)("p",null,"application-prod2.yml"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"spring:\n    profiles: prod2\n\n// ...\n\nserver:\n    port: 8081\n\n")),(0,l.kt)("p",null,"\ucc98\uc74c\uc5d0\ub294 application-prod.yml\uc5d0\uc11c \uad6c\ubd84\uc120\uc744 \uc774\uc6a9\ud574 \ub450 \ud504\ub85c\ud30c\uc77c\uc744 \ubd84\ub9ac\ud574\uc8fc\uc5c8\ub294\ub370, \uc778\uc2dd\uc744 \ud558\uc9c0 \ubabb\ud55c\ub2e4.\n\uadf8\ub7ec\ubbc0\ub85c yml\ud30c\uc77c\uc744 \ud504\ub85c\ud30c\uc77c\ub9c8\ub2e4 \ubd84\ub9ac\ud574\uc900\ub2e4."),(0,l.kt)("br",null),(0,l.kt)("h3",{id:"\uc11c\ubc84-\uc124\uc815-\ubcc0\uacbd"},"\uc11c\ubc84 \uc124\uc815 \ubcc0\uacbd"),(0,l.kt)("p",null,"\ub2e4\uc74c\uc73c\ub85c, \uc11c\ubc84\uc758 \uc124\uc815\uc744 \ubcc0\uacbd\ud55c\ub2e4. \uc544\ub798\uc640 \uac19\uc740 \uc21c\uc11c\ub85c \uc9c4\ud589\ud55c\ub2e4."),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"nginx\uac00 service-url.inc \ub0b4\ubd80\uc5d0\uc11c \uc815\uc758\ub41c \ud3ec\ud2b8\ub97c \uc774\uc6a9\ud558\ub3c4\ub85d \uc124\uc815\ud55c\ub2e4."),(0,l.kt)("li",{parentName:"ol"},"\ubc30\ud3ec \uc2a4\ud06c\ub9bd\ud2b8\uc5d0\uc11c \ud604\uc7ac \uc11c\ube44\uc2a4 \uc911\uc778 \uc2a4\ud504\ub9c1\ubd80\ud2b8\uc758 \ud504\ub85c\ud30c\uc77c\uc744 \ud655\uc778\ud558\uc5ec \ubc30\ud3ec\ub420 \uc2a4\ud504\ub9c1\ubd80\ud2b8\uc758 \ud504\ub85c\ud30c\uc77c\uacfc \ud3ec\ud2b8\ub97c \uc124\uc815\ud55c\ub2e4."),(0,l.kt)("li",{parentName:"ol"},"switch.sh\uc5d0\uc11c service-url.inc \ub0b4\ubd80\uc758 \ud3ec\ud2b8\ub97c \ubcc0\uacbd\ud55c\ub2e4.")),(0,l.kt)("br",null),(0,l.kt)("h4",{id:"1-nginx\uac00-service-urlinc-\ub0b4\ubd80\uc5d0\uc11c-\uc815\uc758\ub41c-\ud3ec\ud2b8\ub97c-\uc774\uc6a9\ud558\ub3c4\ub85d-\uc124\uc815\ud55c\ub2e4"},"1. nginx\uac00 service-url.inc \ub0b4\ubd80\uc5d0\uc11c \uc815\uc758\ub41c \ud3ec\ud2b8\ub97c \uc774\uc6a9\ud558\ub3c4\ub85d \uc124\uc815\ud55c\ub2e4."),(0,l.kt)("p",null,"\uae30\uc874\uc758 nginx \uc124\uc815 \ud30c\uc77c\uc744 \uc544\ub798\uc640 \uac19\uc774 \ubcc0\uacbd\ud55c\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"server {\n        // ...\n        include /(\uc0dd\ub7b5)/service-url.inc;\n\n        location / {\n        proxy_pass $service_url$request_uri;\n    }\n\n        location /post-images {\n                alias /var/www/html/file/post-images;\n                try_files $uri $uri/ =404;\n        }\n\n        location /route-images {\n                alias /var/www/html/file/route-images;\n                try_files $uri $uri/ =404;\n        }\n}\n\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"include /(\uc0dd\ub7b5)/service-url.inc;"),"\n: \ud574\ub2f9 \uc124\uc815 \ud30c\uc77c\uc5d0\uc11c ",(0,l.kt)("inlineCode",{parentName:"p"},"service-url.inc")," \ub0b4\ubd80\uc758 \ubcc0\uc218 \ub4f1\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uac8c \ud55c\ub2e4."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"proxy_pass $service_url$request_uri;"),"\n: service-url.inc\uc5d0 \uc124\uc815\ub41c url\uacfc \ud604\uc7ac \uc694\uccad\uc774 \uac00\uc9c0\uace0 \uc788\ub294 uri\ub97c \ud569\uce5c Path\ub85c \uc694\uccad\uc744 \ubcf4\ub0b8\ub2e4."),(0,l.kt)("p",null,"service-url.inc"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"set $service_url <http://127.0.0.1:8080>;\n\n")),(0,l.kt)("p",null,"nginx \uc124\uc815 \ud30c\uc77c\uc5d0 ",(0,l.kt)("inlineCode",{parentName:"p"},"$service_url")," \uc744 \uc81c\uacf5\ud55c\ub2e4. \uae30\ubcf8\uc740 \ub8e8\ud504\ubc31 IP\uc640 8080\ud3ec\ud2b8\uc774\ub2e4."),(0,l.kt)("br",null),(0,l.kt)("h4",{id:"2-\ubc30\ud3ec-\uc2a4\ud06c\ub9bd\ud2b8\uc5d0\uc11c-\ud604\uc7ac-\uc11c\ube44\uc2a4-\uc911\uc778-\uc2a4\ud504\ub9c1\ubd80\ud2b8\uc758-\ud504\ub85c\ud30c\uc77c\uc744-\ud655\uc778\ud558\uc5ec-\ubc30\ud3ec\ub420-\uc2a4\ud504\ub9c1\ubd80\ud2b8\uc758-\ud504\ub85c\ud30c\uc77c\uacfc-\ud3ec\ud2b8\ub97c-\uc124\uc815\ud55c\ub2e4"},"2. \ubc30\ud3ec \uc2a4\ud06c\ub9bd\ud2b8\uc5d0\uc11c \ud604\uc7ac \uc11c\ube44\uc2a4 \uc911\uc778 \uc2a4\ud504\ub9c1\ubd80\ud2b8\uc758 \ud504\ub85c\ud30c\uc77c\uc744 \ud655\uc778\ud558\uc5ec \ubc30\ud3ec\ub420 \uc2a4\ud504\ub9c1\ubd80\ud2b8\uc758 \ud504\ub85c\ud30c\uc77c\uacfc \ud3ec\ud2b8\ub97c \uc124\uc815\ud55c\ub2e4."),(0,l.kt)("p",null,"\ub2e4\uc74c\uc73c\ub85c, \ubc30\ud3ec \uc2dc\uc5d0 \ud504\ub85c\ud30c\uc77c \ubcc4\ub85c \ud574\ub2f9\ud558\ub294 \ud3ec\ud2b8\uc0ac\uc6a9\ud558\ub3c4\ub85d \uc2a4\ud06c\ub9bd\ud2b8\ub97c \ubcc0\uacbd\ud558\uc790."),(0,l.kt)("p",null,"\uae30\uc874\uc758 \ubc30\ud3ec \uc2a4\ud06c\ub9bd\ud2b8\ub294 \uc544\ub798\uc640 \uac19\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'echo "Start Deploy Script"\n// ...\n\ncd $ACTIONS_REPO_NAME\ngit pull origin main\ngit switch main\n\necho "Change Directory"\ncd $REPOSITORY_NAME\n\necho "Build"\n./gradlew bootJar\n\necho "Copy"\nmv ./build/libs/$PROJECT_NAME.jar .\n\necho "Shutdown Application"\nPID=$(pgrep -f $PROJECT_NAME)\n\nif [ -n $PID ]; then\n        kill -9 $PID\n    sleep 5\nfi\n\necho "Start Server"\nnohup java -jar -Dspring.profiles.active=prod $PROJECT_NAME.jar 1>stdout.txt 2>err.txt &\n\n')),(0,l.kt)("p",null,"\ubcc0\uacbd\ub41c \ubc30\ud3ec \uc2a4\ud06c\ub9bd\ud2b8"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'echo "Start Deploy Script"\n// ...\n\ncd $ACTIONS_REPO_NAME\ngit pull origin develop-backend\ngit switch develop-backend\n\necho "Change Directory"\ncd $REPOSITORY_NAME\n\necho "Build"\n./gradlew bootJar\n\necho "Copy"\nmv ./build/libs/$PROJECT_NAME.jar .\n\necho "Check Current Profile"\n# \ud604\uc7ac \uc0ac\uc6a9\uc911\uc778 \ud504\ub85c\ud544\uc744 \ud655\uc778\ud55c\ub2e4\nCURRENT_PROFILE=$(curl -s <https://dev.tripdraw.site/profile>)\necho "Current Profile : $CURRENT_PROFILE"\n\nprod1="prod1"\nprod2="prod2"\n\n# \uc0ac\uc6a9\ud560 \ud504\ub85c\ud30c\uc77c\uacfc \ud3ec\ud2b8\ub97c \uc124\uc815\ud55c\ub2e4.\nif [ "$CURRENT_PROFILE" = "$prod1" ]\nthen\n        IDLE_PROFILE="$prod2"\n        IDLE_PORT=8081\nelif [ "$CURRENT_PROFILE" = "$prod2" ]\nthen\n        IDLE_PROFILE="$prod1"\n        IDLE_PORT=8080\nelse\n        echo "No Valid Profile"\n        echo "Set Profile as prod1"\n        IDLE_PROFILE="$prod1"\n        IDLE_PORT=8080\nfi\n\necho "Idle Profile : $IDLE_PROFILE, Idle Port : $IDLE_PORT"\n\n// \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ub744\uc6b8 \ud3ec\ud2b8\ub97c \ubcc0\uacbd\ud55c\ub2e4.\necho "Switching"\nsleep 10\n(\uc0dd\ub7b5)/switch.sh\n\necho "Shutdown Existing Application"\nPID=$(pgrep -f $PROJECT_NAME)\n\nif [ -n "$PID" ]; then\n        kill -9 $PID\n        sleep 5\nfi\n\necho "Start Server"\nnohup java -jar -Dspring.profiles.active=$IDLE_PROFILE $PROJECT_NAME.jar 1>stdout.txt 2>err.txt &\n\n')),(0,l.kt)("p",null,"\uc2a4\ud06c\ub9bd\ud2b8\uc5d0 \uc8fc\uc11d\uc73c\ub85c \ud574\ub2f9 \uacfc\uc815\uc5d0 \ub300\ud55c \uc124\uba85\uc744 \uc791\uc131\ud588\ub2e4."),(0,l.kt)("br",null),(0,l.kt)("h4",{id:"3-switchsh\uc5d0\uc11c-service-urlinc-\ub0b4\ubd80\uc758-\ud3ec\ud2b8\ub97c-\ubcc0\uacbd\ud55c\ub2e4"},"3. switch.sh\uc5d0\uc11c service-url.inc \ub0b4\ubd80\uc758 \ud3ec\ud2b8\ub97c \ubcc0\uacbd\ud55c\ub2e4."),(0,l.kt)("p",null,"switch.sh"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'CURRENT_PROFILE=$(curl -s (\uc0dd\ub7b5))\n\n// \uc0ac\uc6a9\ud560 \ud3ec\ud2b8 \uc124\uc815\nprod1="prod1"\nprod2="prod2"\n\nif [ "$CURRENT_PROFILE" = "$prod1" ]\nthen\n  IDLE_PORT=8081\nelif [ "$CURRENT_PROFILE" = "$prod2" ]\nthen\n  IDLE_PORT=8080\nelse\n  echo "No Valid Profile"\n  echo "Set profile as prod1"\n  IDLE_PORT=8080\nfi\n\necho "Switch Target Port: $IDLE_PORT"\necho "Swith"\n// servic-url.inc\uc5d0 \uc788\ub294 $service_url\uc744 \uc124\uc815 \uac12\uc73c\ub85c \ubcc0\uacbd\ud558\uba70 \ucd9c\ub825\ub3c4 \ub3d9\uc2dc\uc5d0 \ud55c\ub2e4.\necho "set \\\\$service_url <http://127.0.0.1>:${IDLE_PORT};" |sudo tee /etc/nginx/conf.d/service-url.inc\n\necho "Nginx Reload"\nsudo service nginx reload\n\n')),(0,l.kt)("p",null,"\uc704\uc640 \uac19\uc740 \ubc29\ubc95\uc73c\ub85c \ubcc0\uacbd\ub41c \ud3ec\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub3c4\ub85d nginx\ub97c reload\ud558\uc5ec \ubb34\uc911\ub2e8 \ubc30\ud3ec\ub97c \uad6c\ud604\ud588\ub2e4."))}d.isMDXComponent=!0}}]);